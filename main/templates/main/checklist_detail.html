{% extends 'main/base.html' %}
{% load custom_tags %}

{% block title %}Checklist Detail{% endblock %}

{% block extra_css %}
<style>
    /* Reset all margins and paddings */
    html, body {
        background-color: black !important;
        color: white !important;
        padding: 0 !important;
        margin: 0 !important;
        overflow-x: hidden !important;
        width: 100% !important;
        max-width: 100% !important;
    }
    
    .container-fluid {
        padding-left: 15px !important;
        padding-right: 15px !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
        width: 100% !important;
        max-width: 100% !important;
    }
    
    .container {
        padding-left: 8px !important;
        padding-right: 8px !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
        max-width: 100% !important;
        width: 100% !important;
    }
    
    .row {
        margin-left: -4px !important;
        margin-right: -4px !important;
        width: 100% !important;
    }
    
    .col, .col-12, .col-md-12, [class*='col-'] {
        padding-left: 4px !important;
        padding-right: 4px !important;
    }
    
    .card {
        box-shadow: 0 5px 15px rgba(255, 0, 0, 0.2);
        border: 2px solid #ffffff !important;
        border-radius: 8px;
        margin-bottom: 0.5rem !important;
        background-color: #111 !important;
        color: white !important;
        width: 100% !important;
    }
    
    .card-header {
        border-bottom: 2px solid #ffffff !important;
        padding: 0.6rem 0.8rem !important;
    }
    
    .card-body {
        padding: 0.6rem 0.8rem !important;
    }
    
    .btn-success {
        padding: 6px 15px;
        font-weight: 500;
        background-color: #CC0000 !important;
        border-color: #ffffff !important;
        border-width: 2px;
    }
    
    .btn-success i {
        margin-right: 5px;
    }
    
    .btn-success:hover {
        background-color: #990000 !important;
        border-color: #ffffff !important;
        transform: translateY(-2px);
    }

    .measurement-value {
        font-family: monospace;
        padding: 2px 6px;
        background-color: #222;
        border-radius: 3px;
    }
    
    .checklist-status {
        min-width: 120px;
        text-align: center;
    }
    
    .validation-badge {
        min-width: 50px;
        display: inline-block;
    }
    
    .measurement-table th {
        width: 35%;
        font-weight: 500;
    }
    
    .timeline-item {
        padding: 10px;
        border-left: 3px solid #CC0000;
        margin-bottom: 8px;
        background-color: #222;
    }
    
    .timeline-item.warning {
        border-left-color: #ffc107;
    }
    
    .timeline-item.success {
        border-left-color: #28a745;
    }
    
    .info-card {
        transition: transform 0.2s;
        background: #111 !important;
        border-radius: 10px;
    }
    
    .info-card:hover {
        transform: translateY(-3px);
    }
    
    .status-badge {
        font-size: 0.9rem;
        padding: 0.4rem 0.8rem;
    }
    
    .metric-icon {
        font-size: 1.3rem;
        margin-bottom: 0.4rem;
    }
    
    .progress {
        height: 10px;
        border-radius: 5px;
        background-color: #222;
    }
    
    .metric-value {
        font-size: 1.1rem;
        font-weight: 600;
    }
    
    .metric-label {
        color: #aaa;
        font-size: 0.8rem;
    }
    
    .table {
        color: white !important;
        margin-bottom: 0.4rem !important;
        width: 100% !important;
    }
    
    .table thead th {
        background-color: #222 !important;
        font-weight: 600;
        color: #fff;
        border-color: #444 !important;
        padding: 0.4rem !important;
    }
    
    .table td {
        padding: 0.4rem !important;
    }
    
    .table-bordered td, .table-bordered th {
        border-color: #444 !important;
    }
    
    .bg-primary {
        background-color: #CC0000 !important;
    }
    
    .card-header.bg-light {
        background-color: #222 !important;
        color: white !important;
    }

    .form-row td {
        background-color: rgba(255, 0, 0, 0.1) !important;
    }
    
    .form-row select,
    .form-row input {
        width: 100%;
        background-color: #222;
        color: white;
        border: 1px solid #444;
    }
    
    .form-control-sm {
        height: calc(1.5em + 0.4rem + 2px);
        padding: 0.2rem 0.4rem;
        font-size: 0.85rem;
        line-height: 1.5;
        border-radius: 0.2rem;
        background-color: #222 !important;
        color: white !important;
        border: 1px solid #444 !important;
    }
    
    .table thead th[colspan] {
        text-align: center;
        border-bottom: none;
    }
    
    .table-light {
        background-color: #222 !important;
        color: white !important;
    }
    
    .table-light th {
        color: white !important;
        border-color: #333 !important;
    }
    
    .progress-bar {
        background-color: #CC0000;
    }
    
    .progress-bar.bg-success {
        background-color: #198754 !important;
    }
    
    .badge.bg-success {
        background-color: #198754 !important;
    }
    
    .badge.bg-danger {
        background-color: #CC0000 !important;
    }
    
    .badge.bg-warning {
        background-color: #ffc107 !important;
        color: black !important;
    }
    
    .bg-success-subtle {
        background-color: rgba(25, 135, 84, 0.2) !important;
    }
    
    .bg-danger-subtle {
        background-color: rgba(204, 0, 0, 0.2) !important;
    }
    
    .btn-outline-secondary {
        border-color: white !important;
        color: white !important;
    }
    
    .btn-outline-secondary:hover {
        background-color: rgba(255, 255, 255, 0.1) !important;
    }
    
    .btn-light {
        background-color: white !important;
        color: black !important;
    }
    
    .btn-light:hover {
        background-color: #e0e0e0 !important;
    }
    
    .btn-outline-primary {
        border-color: #CC0000 !important;
        color: white !important;
    }
    
    .btn-outline-primary:hover {
        background-color: #CC0000 !important;
        color: white !important;
    }
    
    .hindi-text {
        font-size: 85%;
        display: block;
        color: #b0b0b0;
        margin-top: 2px;
    }
    
    .subgroup-header {
        text-align: center;
        vertical-align: middle;
    }
    
    .subgroup-header .english-text {
        display: block;
        margin-bottom: 3px;
        font-weight: 500;
    }
    
    .subgroup-header .hindi-text {
        display: block;
        font-size: 80%;
        color: #b0b0b0;
        font-weight: normal;
    }
    
    .subgroup-header .range-text {
        display: block;
        font-size: 75%;
        color: #b0b0b0;
        margin-top: 3px;
    }
    
    .text-muted {
        color: #b0b0b0 !important;
    }
    
    select.form-select-sm, input.form-control-sm {
        background-color: #222;
        color: white;
        border: 1px solid white !important;
        border-radius: 4px;
    }
    
    select.form-select-sm:focus, input.form-control-sm:focus {
        border-color: #CC0000 !important;
        box-shadow: 0 0 5px rgba(204, 0, 0, 0.5);
    }
    
    .table-hover tbody tr:hover {
        background-color: rgba(255, 0, 0, 0.1) !important;
    }
    
    .card.border-light {
        border-color: #333 !important;
    }
    
    .border-light .card-body {
        background-color: #222 !important;
    }
    
    .section-title {
        display: flex;
        flex-direction: column;
    }
    
    .section-title-hindi {
        font-size: 80%;
        color: #ddd;
        font-weight: normal;
    }
    
    .table-header-with-hindi th {
        position: relative;
    }
    
    .table-header-with-hindi .hindi-text {
        font-size: 75%;
        display: block;
        margin-top: 2px;
        font-weight: normal;
    }
    
    .mb-reduced {
        margin-bottom: 0.3rem !important;
    }
    
    .mt-reduced {
        margin-top: 0.3rem !important;
    }
    
    h6.border-bottom {
        padding-bottom: 0.3rem !important;
        margin-bottom: 0.3rem !important;
    }
    
    .btn-sm {
        padding: 0.2rem 0.4rem !important;
        font-size: 0.7rem !important;
    }
    
    body > * {
        max-width: 100% !important;
    }
    
    .compact-table td, .compact-table th {
        padding: 0.3rem !important;
    }
    
    .readings-display {
        font-size: 0.8rem;
        line-height: 1.2;
    }
    
    .readings-summary {
        font-weight: bold;
        margin-bottom: 2px;
    }
    
    .individual-readings {
        color: #aaa;
        font-size: 0.7rem;
    }
    
    /* Maintenance tracking styles */
    .maintenance-indicator {
        background-color: #FFA500;
        border-left: 4px solid #FF8C00;
    }
    
    .comment-box {
        background-color: #1a1a1a;
        border-left: 3px solid #FFA500;
        padding: 8px;
        margin-top: 5px;
        border-radius: 4px;
        font-size: 0.85rem;
    }
    
    .comment-label {
        color: #FFA500;
        font-weight: bold;
        font-size: 0.75rem;
        text-transform: uppercase;
    }
    
    .comment-text {
        color: #ddd;
        margin-top: 3px;
    }
    
    .nok-comment {
         border-left: 3px solid #ff6666;
        padding: 6px;
        margin-top: 3px;
        border-radius: 3px;
        font-size: 0.75rem;
    }
    
    @media (max-width: 768px) {
        h4, .h4 {
            font-size: 1.2rem !important;
        }
        
        h5, .h5 {
            font-size: 1rem !important;
        }
        
        h6, .h6 {
            font-size: 0.9rem !important;
        }
        
        .table {
            font-size: 0.8rem !important;
        }
    }
</style>
{% endblock %}
    
{% block content %}
<div class="container-fluid" style="padding-left: 15px; padding-right: 15px;">
    <!-- Header Information -->
    <div class="card mb-reduced">
        <div class="card-header bg-primary text-white rounded-top">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h4 class="mb-0 section-title">
                        Daily Verification/Inspection Sheet 
                        <span class="section-title-hindi">दैनिक सत्यापन/निरीक्षण शीट</span>
                    </h4>
                    <small class="text-white-50">Generated on {{ checklist.verification_status.shift.date }}</small>
                </div>

            </div>
        </div>
        
        <!-- Main Info Cards -->
        <div class="card-body p-2">
            <!-- Operator Row -->
            <div class="row mb-2">
                <div class="col-12">
                    <div class="d-flex align-items-center flex-wrap">
                        <span class="h6 text-danger me-2 mb-0">Operator<small class="hindi-text">ऑपरेटर</small>:</span>
                        <span class="h6 mb-0">{{ checklist.verification_status.created_by }}</span>
                        <span class="mx-2">|</span>
                        <span class="h6 text-danger me-2 mb-0">Program<small class="hindi-text">प्रोग्राम</small>:</span>
                        <span class="h6 mb-0">{{ checklist.selected_model }}</span>
                        <span class="mx-2">|</span>
                        <span class="h6 text-danger me-2 mb-0">Date<small class="hindi-text">दिनांक</small>:</span>
                        <span class="h6 mb-0">{{ checklist.verification_status.shift.date }}</span>
                        <span class="mx-2">|</span>
                        <span class="h6 text-danger me-2 mb-0">Shift<small class="hindi-text">शिफ्ट</small>:</span>
                        <span class="h6 mb-0">{{ checklist.get_new_shift_display }}</span>
                    </div>
                </div>
            </div>
            

 
        </div>
    </div>
        
<!-- Initial Setup & Tooling Measurements - WITH DYNAMIC VALUES (Only show if there are values) -->
{% if dynamic_values_grouped.initial_setup or dynamic_values_grouped.model_specific %}
<div class="row mb-reduced">
    <div class="col-12">
        <div class="card shadow-lg">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0 section-title">
                    Initial Setup & Tooling Measurements
                    <span class="section-title-hindi">प्रारंभिक सेटअप और टूलिंग माप</span>
                </h5>
            </div>
            <div class="card-body p-2">
                <div class="table-responsive">
                    <table class="table table-bordered table-hover align-middle table-sm compact-table">
                        <thead class="table-light">
                            <tr class="table-header-with-hindi">
                                <th style="width: 35%;">
                                    Parameter
                                    <span class="hindi-text">पैरामीटर</span>
                                </th>
                                <th style="width: 25%;">
                                    Acceptable Range
                                    <span class="hindi-text">स्वीकार्य रेंज</span>
                                </th>
                                <th style="width: 20%;" class="text-center">
                                    Recorded Value
                                    <span class="hindi-text">दर्ज मान</span>
                                </th>
                                <th style="width: 20%;">
                                    Comment
                                    <span class="hindi-text">टिप्पणी</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for dv in dynamic_values_grouped.initial_setup %}
                            <tr class="{% if dv.is_out_of_range or dv.is_nok %}bg-danger-subtle{% else %}bg-success-subtle{% endif %}">
                                <td>
                                    <strong>{{ dv.parameter.parameter_name }}</strong>
                                    {% if dv.parameter.parameter_name_hindi %}
                                        <div class="hindi-text small">{{ dv.parameter.parameter_name_hindi }}</div>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if dv.parameter.measurement_type == 'numeric' %}
                                        {% if dv.parameter.min_value is not None and dv.parameter.max_value is not None %}
                                            <strong>{{ dv.parameter.min_value }} to {{ dv.parameter.max_value }}</strong>
                                            {% if dv.parameter.unit %} {{ dv.parameter.unit }}{% endif %}
                                        {% else %}
                                            <span class="text-muted">N/A</span>
                                        {% endif %}
                                    {% elif dv.parameter.measurement_type == 'ok_nok' %}
                                        Must be <strong>OK</strong>
                                    {% elif dv.parameter.measurement_type == 'yes_no' %}
                                        Must be <strong>Yes</strong>
                                    {% endif %}
                                </td>
                                <td class="text-center">
                                    <span class="badge {% if dv.is_out_of_range or dv.is_nok %}bg-danger{% else %}bg-success{% endif %} fs-6">
                                        {{ dv.value }}
                                    </span>
                                </td>
                                <td>
                                    {% if dv.comment %}
                                        <div class="nok-comment" style="margin-top: 0; padding: 4px;">
                                            <small>{{ dv.comment }}</small>
                                        </div>
                                    {% else %}
                                        <span class="text-muted">--</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                            
                            {% for dv in dynamic_values_grouped.model_specific %}
                            <tr class="{% if dv.is_out_of_range or dv.is_nok %}bg-danger-subtle{% else %}bg-success-subtle{% endif %}">
                                <td>
                                    <strong>{{ dv.parameter.parameter_name }}</strong>
                                    {% if dv.parameter.parameter_name_hindi %}
                                        <div class="hindi-text small">{{ dv.parameter.parameter_name_hindi }}</div>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if dv.parameter.measurement_type == 'numeric' %}
                                        {% if dv.parameter.min_value is not None and dv.parameter.max_value is not None %}
                                            <strong>{{ dv.parameter.min_value }} to {{ dv.parameter.max_value }}</strong>
                                            {% if dv.parameter.unit %} {{ dv.parameter.unit }}{% endif %}
                                        {% else %}
                                            <span class="text-muted">N/A</span>
                                        {% endif %}
                                    {% elif dv.parameter.measurement_type == 'ok_nok' %}
                                        Must be <strong>OK</strong>
                                    {% elif dv.parameter.measurement_type == 'yes_no' %}
                                        Must be <strong>Yes</strong>
                                    {% endif %}
                                </td>
                                <td class="text-center">
                                    <span class="badge {% if dv.is_out_of_range or dv.is_nok %}bg-danger{% else %}bg-success{% endif %} fs-6">
                                        {{ dv.value }}
                                    </span>
                                </td>
                                <td>
                                    {% if dv.comment %}
                                        <div class="nok-comment" style="margin-top: 0; padding: 4px;">
                                            <small>{{ dv.comment }}</small>
                                        </div>
                                    {% else %}
                                        <span class="text-muted">--</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}
<!-- Initial Quality Control Card - WITH DYNAMIC VALUES -->
<div class="row mb-reduced">
    <div class="col-12">
        <div class="card shadow-lg">
            <div class="card-header d-flex justify-content-between align-items-center bg-primary text-white">
                <div>
                    <h5 class="mb-0 section-title">
                        Initial Quality Control Measurements
                        <span class="section-title-hindi">प्रारंभिक गुणवत्ता नियंत्रण माप</span>
                    </h5>
                </div>
                <h6 class="text-white-40">
                    Running Model: {{ checklist.selected_model }}
                    <span class="hindi-text">चल रहा मॉडल</span>
                </h6>
            </div>
            <div class="card-body">
                <!-- Standard Measurements Section - WITH DYNAMIC VALUES -->
                <div class="mb-reduced">
                    <h6 class="border-bottom pb-1 mb-2 text-danger">
                        Process Measurements
                        <span class="hindi-text">प्रक्रिया माप</span>
                    </h6>
                    <div class="table-responsive">
                        <table class="table table-bordered align-middle table-header-with-hindi">
                            <thead class="table-light">
                                <tr>
                                    <th style="width: 40%">
                                        Parameter
                                        <span class="hindi-text">पैरामीटर</span>
                                    </th>
                                    <th style="width: 20%">
                                        Value
                                        <span class="hindi-text">मान</span>
                                    </th>
                                    <th style="width: 40%">
                                        Recommended Range
                                        <span class="hindi-text">अनुशंसित रेंज</span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        Line Pressure
                                        <span class="hindi-text">लाइन प्रेशर</span>
                                    </td>
                                    <td class="text-center">
                                        <span class="validation-badge badge {% if measurement_validation.base_measurements.line_pressure_ok %}bg-success{% else %}bg-danger{% endif %}">
                                            {{ checklist.line_pressure }} bar
                                        </span>
                                    </td>
                                    <td class="text-muted">4.5 - 5.5 bar</td>
                                </tr>
                                <tr>
                                    <td>
                                        UV Flow Input Test Pressure
                                        <span class="hindi-text">यूवी फ्लो इनपुट टेस्ट प्रेशर</span>
                                    </td>
                                    <td class="text-center">
                                        <span class="validation-badge badge {% if measurement_validation.base_measurements.uv_flow_input_ok %}bg-success{% else %}bg-danger{% endif %}">
                                            {{ checklist.uv_flow_input_pressure }} kPa
                                        </span>
                                    </td>
                                    <td class="text-muted">11 - 15 kPa</td>
                                </tr>
                                <tr>
                                    <td>
                                        Test Pressure for Vacuum Generation
                                        <span class="hindi-text">वैक्यूम जनरेशन के लिए टेस्ट प्रेशर</span>
                                    </td>
                                    <td class="text-center">
                                        <span class="validation-badge badge {% if measurement_validation.base_measurements.test_pressure_ok %}bg-success{% else %}bg-danger{% endif %}">
                                            {{ checklist.test_pressure_vacuum }} MPa
                                        </span>
                                    </td>
                                    <td class="text-muted">0.25 - 0.3 MPa</td>
                                </tr>
                                
                                <!-- Dynamic Standard Measurements -->
                                {% for dv in dynamic_values_grouped.standard_measurements %}
                                <tr>
                                    <td>
                                        {{ dv.parameter.parameter_name }}
                                        {% if dv.parameter.parameter_name_hindi %}
                                            <span class="hindi-text">{{ dv.parameter.parameter_name_hindi }}</span>
                                        {% endif %}
                                    </td>
                                    <td class="text-center">
                                        <span class="validation-badge badge {% if dv.is_out_of_range or dv.is_nok %}bg-danger{% else %}bg-success{% endif %}">
                                            {{ dv.value }}{% if dv.parameter.unit %} {{ dv.parameter.unit }}{% endif %}
                                        </span>
                                    </td>
                                    <td class="text-muted">
                                        {% if dv.parameter.measurement_type == 'numeric' and dv.parameter.min_value is not None %}
                                            {{ dv.parameter.min_value }} - {{ dv.parameter.max_value }}{% if dv.parameter.unit %} {{ dv.parameter.unit }}{% endif %}
                                        {% elif dv.parameter.measurement_type == 'ok_nok' %}
                                            Must be OK
                                        {% elif dv.parameter.measurement_type == 'yes_no' %}
                                            Must be Yes
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Quality Checks Section - WITH DYNAMIC VALUES -->
                <div class="mb-reduced">
                    <h6 class="border-bottom pb-1 mb-2 text-danger">
                        Quality Checks
                        <span class="hindi-text">गुणवत्ता जांच</span>
                    </h6>
                    <div class="table-responsive">
                        <table class="table table-bordered align-middle table-header-with-hindi">
                            <thead class="table-light">
                                <tr>
                                    <th style="width: 40%">
                                        Check Parameter
                                        <span class="hindi-text">जांच पैरामीटर</span>
                                    </th>
                                    <th style="width: 20%">
                                        Status
                                        <span class="hindi-text">स्थिति</span>
                                    </th>
                                    <th style="width: 40%">
                                        Recommendation
                                        <span class="hindi-text">अनुशंसा</span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        Current Model Running
                                        <span class="hindi-text">वर्तमान चल रहा मॉडल</span>
                                    </td>
                                    <td class="text-center">
                                        <div class="metric-value text-fa-bold">{{ checklist.selected_model }}</div>
                                    </td>
                                    <td class="text-muted">Program selection on HMI</td>
                                </tr>
                                <tr>
                                    <td>
                                        O-ring Condition
                                        <span class="hindi-text">O-ring सील की स्थिति</span>
                                    </td>
                                    <td class="text-center">
                                        <span class="badge {% if checklist.oring_condition == 'OK' %}bg-success{% else %}bg-danger{% endif %} px-4">
                                            {{ checklist.oring_condition }}
                                        </span>
                                    </td>
                                    <td class="text-muted">No damage / wear out</td>
                                </tr>
                                
                                <!-- Dynamic Status Checks -->
                                {% for dv in dynamic_values_grouped.status_checks %}
                                <tr>
                                    <td>
                                        {{ dv.parameter.parameter_name }}
                                        {% if dv.parameter.parameter_name_hindi %}
                                            <span class="hindi-text">{{ dv.parameter.parameter_name_hindi }}</span>
                                        {% endif %}
                                    </td>
                                    <td class="text-center">
                                        <span class="badge {% if dv.is_nok or dv.value == 'NOK' or dv.value == 'No' %}bg-danger{% else %}bg-success{% endif %} px-4">
                                            {{ dv.value }}
                                        </span>
                                    </td>
                                    <td class="text-muted">
                                        {% if dv.parameter.measurement_type == 'ok_nok' %}
                                            Should be OK
                                        {% elif dv.parameter.measurement_type == 'yes_no' %}
                                            Should be Yes
                                        {% elif dv.parameter.measurement_type == 'numeric' and dv.parameter.min_value is not None %}
                                            {{ dv.parameter.min_value }} - {{ dv.parameter.max_value }}{% if dv.parameter.unit %} {{ dv.parameter.unit }}{% endif %}
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tool IDs and Part Numbers Section - WITH DYNAMIC VALUES -->
                <div>
                    <h6 class="border-bottom pb-1 mb-2 text-danger">
                        Tool IDs and Part Numbers
                        <span class="hindi-text">टूल आईडी और पार्ट नंबर</span>
                    </h6>
                    <div class="table-responsive">
                        <table class="table table-bordered align-middle table-header-with-hindi">
                            <thead class="table-light">
                                <tr>
                                    <th style="width: 30%">
                                        Component
                                        <span class="hindi-text">कंपोनेंट</span>
                                    </th>
                                    <th style="width: 70%">
                                        Identification
                                        <span class="hindi-text">पहचान</span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        Top Tool ID
                                        <span class="hindi-text">टॉप टूल</span>
                                    </td>
                                    <td>
                                        {{ checklist.top_tool_id }}
                                        <span class="badge {% if checklist.top_tool_id_status == 'OK' %}bg-success{% else %}bg-danger{% endif %} px-4 mx-5">
                                            {{ checklist.top_tool_id_status }}
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        Bottom Tool ID
                                        <span class="hindi-text">बॉटम टूल</span>
                                    </td>
                                    <td>
                                        {{ checklist.bottom_tool_id }}
                                        <span class="badge {% if checklist.bottom_tool_id_status == 'OK' %}bg-success{% else %}bg-danger{% endif %} px-4 mx-5">
                                            {{ checklist.bottom_tool_id_status }}
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        UV Assy Stage ID
                                        <span class="hindi-text">यूवी असेंबली</span>
                                    </td>
                                    <td>
                                        {{ checklist.uv_assy_stage_id }}
                                        <span class="badge {% if checklist.uv_assy_stage_id_status == 'OK' %}bg-success{% else %}bg-danger{% endif %} px-4 mx-5">
                                            {{ checklist.uv_assy_stage_id_status }}
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        Retainer Part No
                                        <span class="hindi-text">रिटेनर पार्ट</span>
                                    </td>
                                    <td>
                                        {{ checklist.retainer_part_no }}
                                        <span class="badge {% if checklist.retainer_part_no_status == 'OK' %}bg-success{% else %}bg-danger{% endif %} px-4 mx-5">
                                            {{ checklist.retainer_part_no_status }}
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        UV Clip Part No
                                        <span class="hindi-text">यूवी क्लिप</span>
                                    </td>
                                    <td>
                                        {{ checklist.uv_clip_part_no }}
                                        <span class="badge {% if checklist.uv_clip_part_no_status == 'OK' %}bg-success{% else %}bg-danger{% endif %} px-4 mx-5">
                                            {{ checklist.uv_clip_part_no_status }}
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        Umbrella Part No
                                        <span class="hindi-text">अम्ब्रेला पार्ट</span>
                                    </td>
                                    <td>
                                        {{ checklist.umbrella_part_no }}
                                        <span class="badge {% if checklist.umbrella_part_no_status == 'OK' %}bg-success{% else %}bg-danger{% endif %} px-4 mx-5">
                                            {{ checklist.umbrella_part_no_status }}
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        Retainer ID Lubrication
                                        <span class="hindi-text">रिटेनर लुब्रिकेशन</span>
                                    </td>
                                    <td class="text-center">
                                        <span class="badge {% if checklist.retainer_id_lubrication == 'OK' %}bg-success{% else %}bg-danger{% endif %} px-4">
                                            {{ checklist.retainer_id_lubrication }}
                                        </span>
                                    </td>
                                </tr>
                                
                                <!-- Dynamic IDs and Part Numbers -->
                                {% for dv in dynamic_values_grouped.ids_part_numbers %}
                                <tr>
                                    <td>
                                        {{ dv.parameter.parameter_name }}
                                        {% if dv.parameter.parameter_name_hindi %}
                                            <span class="hindi-text">{{ dv.parameter.parameter_name_hindi }}</span>
                                        {% endif %}
                                    </td>
                                    <td class="text-center">
                                        <span class="badge {% if dv.is_nok or dv.value == 'NOK' or dv.value == 'No' %}bg-danger{% else %}bg-success{% endif %} px-4">
                                            {{ dv.value }}
                                        </span>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

    <!-- Subgroup Measurements -->
    <div class="row mb-reduced">




        <!-- ENHANCED: Parameter Entries Section with Verification -->
{% if parameter_entries or can_add_parameters %}
<div class="row mb-reduced">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0 section-title">
                    <i class="fas fa-list-alt"></i> Subgroup Entries with Verification
                </h5>
                {% if can_add_parameters %}
                <a href="{% url 'fill_parameter_group' checklist.id %}" class="btn btn-success">
                    <i class="fas fa-edit"></i> 
                    Fill Parameters
                    <span class="hindi-text">पैरामीटर भरें</span>
                </a>
                {% endif %}
            </div>
            <div class="card-body">
                {% if parameter_entries %}
                    <!-- Statistics Bar -->
                    <div style="background: linear-gradient(145deg, #CC0000, #990000); padding: 12px; border-radius: 8px; margin-bottom: 15px; display: flex; justify-content: space-around;">
                        <div style="text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #fff;">{{ parameter_entries.count }}</div>
                            <div style="font-size: 0.85rem; color: #ddd;">Total Entries <span class="hindi-text">कुल प्रविष्टियाँ</span></div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #fff;">{{ parameter_metrics.total_count }}</div>
                            <div style="font-size: 0.85rem; color: #ddd;">Parameters <span class="hindi-text">पैरामीटर</span></div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #fff;">{{ parameter_metrics.completion_percentage }}%</div>
                            <div style="font-size: 0.85rem; color: #ddd;">Complete <span class="hindi-text">पूर्ण</span></div>
                        </div>
                    </div>

                    {% for param_data in parameter_entries_grouped %}
                    <div style="background: linear-gradient(145deg, #1a1a1a, #0d0d0d); border: 2px solid #28a745; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                        <!-- Parameter Header with Verification Stats -->
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 2px solid #444; padding-bottom: 10px;">
                            <div>
                                <span style="font-size: 1.2rem; font-weight: bold; color: #fff;">
                                    <i class="fas fa-check-circle" style="color: #28a745;"></i>
                                    {{ param_data.display_name }}
                                </span>
                                <span style="background: #CC0000; color: white; padding: 3px 12px; border-radius: 15px; font-size: 0.8rem; margin-left: 10px;">
                                    {{ param_data.entry_count }} entries
                                </span>
                                {% if param_data.has_range %}
                                <span style="background: rgba(40, 167, 69, 0.2); border: 1px solid #28a745; color: #28a745; padding: 3px 12px; border-radius: 15px; font-size: 0.75rem; margin-left: 5px;">
                                    ✓ Range: {{ param_data.range_text }}
                                </span>
                                {% endif %}
                            </div>
                            
                        </div>
                        
                        <!-- Entries Table -->
                        <div class="table-responsive">
                            <table class="table table-bordered table-sm" style="margin-bottom: 0; background: #000;">
                                <thead style="background: #222; color: white;">
                                    <tr>
                                        <th style="width: 4%; text-align: center; vertical-align: middle;">Entry<br>#</th>
                                        <th style="width: 10%; vertical-align: middle;">Time<br>Submitted</th>
                                        
                                        <!-- Dynamic headers based on parameter type -->
                                        {% if param_data.parameter_group == 'uv_vacuum' %}
                                        <th style="width: 8%; text-align: center; vertical-align: middle;">R1<br>(kPa)</th>
                                        <th style="width: 8%; text-align: center; vertical-align: middle;">R2<br>(kPa)</th>
                                        <th style="width: 8%; text-align: center; vertical-align: middle;">R3<br>(kPa)</th>
                                        <th style="width: 8%; text-align: center; vertical-align: middle;">R4<br>(kPa)</th>
                                        <th style="width: 8%; text-align: center; vertical-align: middle;">R5<br>(kPa)</th>
                                        
                                        {% elif param_data.parameter_group == 'uv_flow' %}
                                        <th style="width: 8%; text-align: center; vertical-align: middle;">R1<br>(LPM)</th>
                                        <th style="width: 8%; text-align: center; vertical-align: middle;">R2<br>(LPM)</th>
                                        <th style="width: 8%; text-align: center; vertical-align: middle;">R3<br>(LPM)</th>
                                        <th style="width: 8%; text-align: center; vertical-align: middle;">R4<br>(LPM)</th>
                                        <th style="width: 8%; text-align: center; vertical-align: middle;">R5<br>(LPM)</th>
                                        
                                        {% elif param_data.parameter_group == 'umbrella_valve' %}
                                        <th style="width: 8%; text-align: center; vertical-align: middle;">Check 1</th>
                                        <th style="width: 8%; text-align: center; vertical-align: middle;">Check 2</th>
                                        <th style="width: 8%; text-align: center; vertical-align: middle;">Check 3</th>
                                        <th style="width: 8%; text-align: center; vertical-align: middle;">Check 4</th>
                                        <th style="width: 8%; text-align: center; vertical-align: middle;">Check 5</th>
                                        
                                        {% elif param_data.parameter_group == 'uv_clip' %}
                                        <th style="width: 8%; text-align: center; vertical-align: middle;">Check 1</th>
                                        <th style="width: 8%; text-align: center; vertical-align: middle;">Check 2</th>
                                        <th style="width: 8%; text-align: center; vertical-align: middle;">Check 3</th>
                                        <th style="width: 8%; text-align: center; vertical-align: middle;">Check 4</th>
                                        <th style="width: 8%; text-align: center; vertical-align: middle;">Check 5</th>
                                        
                                        {% elif param_data.parameter_group == 'workstation' %}
                                        <th style="width: 15%; text-align: center; vertical-align: middle;">Status</th>
                                        
                                        {% elif param_data.parameter_group == 'bin_contamination' %}
                                        <th style="width: 8%; text-align: center; vertical-align: middle;">Bin 1</th>
                                        <th style="width: 8%; text-align: center; vertical-align: middle;">Bin 2</th>
                                        <th style="width: 8%; text-align: center; vertical-align: middle;">Bin 3</th>
                                        <th style="width: 8%; text-align: center; vertical-align: middle;">Bin 4</th>
                                        <th style="width: 8%; text-align: center; vertical-align: middle;">Bin 5</th>
                                        {% endif %}
                                        
                                        <th style="width: 15%; text-align: center; vertical-align: middle;">Comments</th>
                                        <th style="width: 12%; text-align: center; vertical-align: middle;">Verification</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for entry in param_data.entries %}
                                    <tr style="{% if entry.is_after_maintenance %}background-color: rgba(255, 193, 7, 0.15);{% else %}background: #1a1a1a;{% endif %}">
                                        <!-- Entry Number -->
                                        <td class="text-center fw-bold" style="color: #ffc107; font-size: 1.1rem; vertical-align: middle;">
                                            {{ forloop.counter }}
                                        </td>
                                        
                                        <!-- Timestamp -->
                                        <td style="color: white; vertical-align: middle; font-size: 0.85rem;">
                                            <div><i class="fas fa-calendar"></i> {{ entry.timestamp|date:"d M Y" }}</div>
                                            <div><i class="fas fa-clock"></i> {{ entry.timestamp|date:"H:i:s" }}</div>
                                            {% if entry.is_after_maintenance %}
                                            <div class="mt-1">
                                                <span class="badge bg-warning text-dark" style="font-size: 0.7rem;">
                                                    <i class="fas fa-tools"></i> After Maintenance
                                                </span>
                                            </div>
                                            {% endif %}
                                        </td>
                                        
                                        <!-- Parameter Values (UV Vacuum) -->
                                        {% if param_data.parameter_group == 'uv_vacuum' %}
                                            {% with r1=entry.uv_vacuum_test_1 r2=entry.uv_vacuum_test_2 r3=entry.uv_vacuum_test_3 r4=entry.uv_vacuum_test_4 r5=entry.uv_vacuum_test_5 %}
                                            <td class="text-center" style="{% if r1 and r1 > -35 or r1 and r1 < -43 %}background-color: rgba(220, 53, 69, 0.3); border: 2px solid #dc3545;{% endif %} color: white; font-weight: bold; font-size: 0.95rem; vertical-align: middle;">
                                                {% if r1 %}{{ r1 }}{% if r1 > -35 or r1 < -43 %}<br><small style="color: #ff6b6b;">⚠️ Out</small>{% endif %}{% else %}<span style="color: #666;">—</span>{% endif %}
                                            </td>
                                            <td class="text-center" style="{% if r2 and r2 > -35 or r2 and r2 < -43 %}background-color: rgba(220, 53, 69, 0.3); border: 2px solid #dc3545;{% endif %} color: white; font-weight: bold; font-size: 0.95rem; vertical-align: middle;">
                                                {% if r2 %}{{ r2 }}{% if r2 > -35 or r2 < -43 %}<br><small style="color: #ff6b6b;">⚠️ Out</small>{% endif %}{% else %}<span style="color: #666;">—</span>{% endif %}
                                            </td>
                                            <td class="text-center" style="{% if r3 and r3 > -35 or r3 and r3 < -43 %}background-color: rgba(220, 53, 69, 0.3); border: 2px solid #dc3545;{% endif %} color: white; font-weight: bold; font-size: 0.95rem; vertical-align: middle;">
                                                {% if r3 %}{{ r3 }}{% if r3 > -35 or r3 < -43 %}<br><small style="color: #ff6b6b;">⚠️ Out</small>{% endif %}{% else %}<span style="color: #666;">—</span>{% endif %}
                                            </td>
                                            <td class="text-center" style="{% if r4 and r4 > -35 or r4 and r4 < -43 %}background-color: rgba(220, 53, 69, 0.3); border: 2px solid #dc3545;{% endif %} color: white; font-weight: bold; font-size: 0.95rem; vertical-align: middle;">
                                                {% if r4 %}{{ r4 }}{% if r4 > -35 or r4 < -43 %}<br><small style="color: #ff6b6b;">⚠️ Out</small>{% endif %}{% else %}<span style="color: #666;">—</span>{% endif %}
                                            </td>
                                            <td class="text-center" style="{% if r5 and r5 > -35 or r5 and r5 < -43 %}background-color: rgba(220, 53, 69, 0.3); border: 2px solid #dc3545;{% endif %} color: white; font-weight: bold; font-size: 0.95rem; vertical-align: middle;">
                                                {% if r5 %}{{ r5 }}{% if r5 > -35 or r5 < -43 %}<br><small style="color: #ff6b6b;">⚠️ Out</small>{% endif %}{% else %}<span style="color: #666;">—</span>{% endif %}
                                            </td>
                                            {% endwith %}
                                        
                                        <!-- Parameter Values (UV Flow) -->
                                        {% elif param_data.parameter_group == 'uv_flow' %}
                                            {% with r1=entry.uv_flow_value_1 r2=entry.uv_flow_value_2 r3=entry.uv_flow_value_3 r4=entry.uv_flow_value_4 r5=entry.uv_flow_value_5 %}
                                            <td class="text-center" style="{% if r1 and r1 < 30 or r1 and r1 > 40 %}background-color: rgba(220, 53, 69, 0.3); border: 2px solid #dc3545;{% endif %} color: white; font-weight: bold; font-size: 0.95rem; vertical-align: middle;">
                                                {% if r1 %}{{ r1 }}{% if r1 < 30 or r1 > 40 %}<br><small style="color: #ff6b6b;">⚠️ Out</small>{% endif %}{% else %}<span style="color: #666;">—</span>{% endif %}
                                            </td>
                                            <td class="text-center" style="{% if r2 and r2 < 30 or r2 and r2 > 40 %}background-color: rgba(220, 53, 69, 0.3); border: 2px solid #dc3545;{% endif %} color: white; font-weight: bold; font-size: 0.95rem; vertical-align: middle;">
                                                {% if r2 %}{{ r2 }}{% if r2 < 30 or r2 > 40 %}<br><small style="color: #ff6b6b;">⚠️ Out</small>{% endif %}{% else %}<span style="color: #666;">—</span>{% endif %}
                                            </td>
                                            <td class="text-center" style="{% if r3 and r3 < 30 or r3 and r3 > 40 %}background-color: rgba(220, 53, 69, 0.3); border: 2px solid #dc3545;{% endif %} color: white; font-weight: bold; font-size: 0.95rem; vertical-align: middle;">
                                                {% if r3 %}{{ r3 }}{% if r3 < 30 or r3 > 40 %}<br><small style="color: #ff6b6b;">⚠️ Out</small>{% endif %}{% else %}<span style="color: #666;">—</span>{% endif %}
                                            </td>
                                            <td class="text-center" style="{% if r4 and r4 < 30 or r4 and r4 > 40 %}background-color: rgba(220, 53, 69, 0.3); border: 2px solid #dc3545;{% endif %} color: white; font-weight: bold; font-size: 0.95rem; vertical-align: middle;">
                                                {% if r4 %}{{ r4 }}{% if r4 < 30 or r4 > 40 %}<br><small style="color: #ff6b6b;">⚠️ Out</small>{% endif %}{% else %}<span style="color: #666;">—</span>{% endif %}
                                            </td>
                                            <td class="text-center" style="{% if r5 and r5 < 30 or r5 and r5 > 40 %}background-color: rgba(220, 53, 69, 0.3); border: 2px solid #dc3545;{% endif %} color: white; font-weight: bold; font-size: 0.95rem; vertical-align: middle;">
                                                {% if r5 %}{{ r5 }}{% if r5 < 30 or r5 > 40 %}<br><small style="color: #ff6b6b;">⚠️ Out</small>{% endif %}{% else %}<span style="color: #666;">—</span>{% endif %}
                                            </td>
                                            {% endwith %}
                                        
                                        <!-- Parameter Values (Umbrella Valve) -->
                                        {% elif param_data.parameter_group == 'umbrella_valve' %}
                                        <td class="text-center" style="{% if entry.umbrella_valve_assembly_1 == 'NOK' %}background-color: rgba(220, 53, 69, 0.3); border: 2px solid #dc3545;{% endif %} vertical-align: middle;">
                                            <span class="badge {% if entry.umbrella_valve_assembly_1 == 'OK' %}bg-success{% else %}bg-danger{% endif %}" style="font-size: 0.85rem; padding: 5px 10px;">
                                                {{ entry.umbrella_valve_assembly_1|default:"—" }}
                                            </span>
                                        </td>
                                        <td class="text-center" style="{% if entry.umbrella_valve_assembly_2 == 'NOK' %}background-color: rgba(220, 53, 69, 0.3); border: 2px solid #dc3545;{% endif %} vertical-align: middle;">
                                            <span class="badge {% if entry.umbrella_valve_assembly_2 == 'OK' %}bg-success{% else %}bg-danger{% endif %}" style="font-size: 0.85rem; padding: 5px 10px;">
                                                {{ entry.umbrella_valve_assembly_2|default:"—" }}
                                            </span>
                                        </td>
                                        <td class="text-center" style="{% if entry.umbrella_valve_assembly_3 == 'NOK' %}background-color: rgba(220, 53, 69, 0.3); border: 2px solid #dc3545;{% endif %} vertical-align: middle;">
                                            <span class="badge {% if entry.umbrella_valve_assembly_3 == 'OK' %}bg-success{% else %}bg-danger{% endif %}" style="font-size: 0.85rem; padding: 5px 10px;">
                                                {{ entry.umbrella_valve_assembly_3|default:"—" }}
                                            </span>
                                        </td>
                                        <td class="text-center" style="{% if entry.umbrella_valve_assembly_4 == 'NOK' %}background-color: rgba(220, 53, 69, 0.3); border: 2px solid #dc3545;{% endif %} vertical-align: middle;">
                                            <span class="badge {% if entry.umbrella_valve_assembly_4 == 'OK' %}bg-success{% else %}bg-danger{% endif %}" style="font-size: 0.85rem; padding: 5px 10px;">
                                                {{ entry.umbrella_valve_assembly_4|default:"—" }}
                                            </span>
                                        </td>
                                        <td class="text-center" style="{% if entry.umbrella_valve_assembly_5 == 'NOK' %}background-color: rgba(220, 53, 69, 0.3); border: 2px solid #dc3545;{% endif %} vertical-align: middle;">
                                            <span class="badge {% if entry.umbrella_valve_assembly_5 == 'OK' %}bg-success{% else %}bg-danger{% endif %}" style="font-size: 0.85rem; padding: 5px 10px;">
                                                {{ entry.umbrella_valve_assembly_5|default:"—" }}
                                            </span>
                                        </td>
                                        
                                        <!-- Parameter Values (UV Clip) -->
                                        {% elif param_data.parameter_group == 'uv_clip' %}
                                        <td class="text-center" style="{% if entry.uv_clip_pressing_1 == 'NOK' %}background-color: rgba(220, 53, 69, 0.3); border: 2px solid #dc3545;{% endif %} vertical-align: middle;">
                                            <span class="badge {% if entry.uv_clip_pressing_1 == 'OK' %}bg-success{% else %}bg-danger{% endif %}" style="font-size: 0.85rem; padding: 5px 10px;">
                                                {{ entry.uv_clip_pressing_1|default:"—" }}
                                            </span>
                                        </td>
                                        <td class="text-center" style="{% if entry.uv_clip_pressing_2 == 'NOK' %}background-color: rgba(220, 53, 69, 0.3); border: 2px solid #dc3545;{% endif %} vertical-align: middle;">
                                            <span class="badge {% if entry.uv_clip_pressing_2 == 'OK' %}bg-success{% else %}bg-danger{% endif %}" style="font-size: 0.85rem; padding: 5px 10px;">
                                                {{ entry.uv_clip_pressing_2|default:"—" }}
                                            </span>
                                        </td>
                                        <td class="text-center" style="{% if entry.uv_clip_pressing_3 == 'NOK' %}background-color: rgba(220, 53, 69, 0.3); border: 2px solid #dc3545;{% endif %} vertical-align: middle;">
                                            <span class="badge {% if entry.uv_clip_pressing_3 == 'OK' %}bg-success{% else %}bg-danger{% endif %}" style="font-size: 0.85rem; padding: 5px 10px;">
                                                {{ entry.uv_clip_pressing_3|default:"—" }}
                                            </span>
                                        </td>
                                        <td class="text-center" style="{% if entry.uv_clip_pressing_4 == 'NOK' %}background-color: rgba(220, 53, 69, 0.3); border: 2px solid #dc3545;{% endif %} vertical-align: middle;">
                                            <span class="badge {% if entry.uv_clip_pressing_4 == 'OK' %}bg-success{% else %}bg-danger{% endif %}" style="font-size: 0.85rem; padding: 5px 10px;">
                                                {{ entry.uv_clip_pressing_4|default:"—" }}
                                            </span>
                                        </td>
                                        <td class="text-center" style="{% if entry.uv_clip_pressing_5 == 'NOK' %}background-color: rgba(220, 53, 69, 0.3); border: 2px solid #dc3545;{% endif %} vertical-align: middle;">
                                            <span class="badge {% if entry.uv_clip_pressing_5 == 'OK' %}bg-success{% else %}bg-danger{% endif %}" style="font-size: 0.85rem; padding: 5px 10px;">
                                                {{ entry.uv_clip_pressing_5|default:"—" }}
                                            </span>
                                        </td>
                                        
                                        <!-- Parameter Values (Workstation) -->
                                        {% elif param_data.parameter_group == 'workstation' %}
                                        <td class="text-center" style="{% if entry.workstation_clean == 'No' %}background-color: rgba(220, 53, 69, 0.3); border: 2px solid #dc3545;{% endif %} vertical-align: middle;">
                                            <span class="badge {% if entry.workstation_clean == 'Yes' %}bg-success{% else %}bg-danger{% endif %}" style="font-size: 1rem; padding: 8px 20px;">
                                                {{ entry.workstation_clean|default:"—" }}
                                            </span>
                                        </td>
                                        
                                        <!-- Parameter Values (Bin Contamination) -->
                                        {% elif param_data.parameter_group == 'bin_contamination' %}
                                        <td class="text-center" style="{% if entry.bin_contamination_check_1 == 'No' %}background-color: rgba(220, 53, 69, 0.3); border: 2px solid #dc3545;{% endif %} vertical-align: middle;">
                                            <span class="badge {% if entry.bin_contamination_check_1 == 'Yes' %}bg-success{% else %}bg-danger{% endif %}" style="font-size: 0.85rem; padding: 5px 10px;">
                                                {{ entry.bin_contamination_check_1|default:"—" }}
                                            </span>
                                        </td>
                                        <td class="text-center" style="{% if entry.bin_contamination_check_2 == 'No' %}background-color: rgba(220, 53, 69, 0.3); border: 2px solid #dc3545;{% endif %} vertical-align: middle;">
                                            <span class="badge {% if entry.bin_contamination_check_2 == 'Yes' %}bg-success{% else %}bg-danger{% endif %}" style="font-size: 0.85rem; padding: 5px 10px;">
                                                {{ entry.bin_contamination_check_2|default:"—" }}
                                            </span>
                                        </td>
                                        <td class="text-center" style="{% if entry.bin_contamination_check_3 == 'No' %}background-color: rgba(220, 53, 69, 0.3); border: 2px solid #dc3545;{% endif %} vertical-align: middle;">
                                            <span class="badge {% if entry.bin_contamination_check_3 == 'Yes' %}bg-success{% else %}bg-danger{% endif %}" style="font-size: 0.85rem; padding: 5px 10px;">
                                                {{ entry.bin_contamination_check_3|default:"—" }}
                                            </span>
                                        </td>
                                        <td class="text-center" style="{% if entry.bin_contamination_check_4 == 'No' %}background-color: rgba(220, 53, 69, 0.3); border: 2px solid #dc3545;{% endif %} vertical-align: middle;">
                                            <span class="badge {% if entry.bin_contamination_check_4 == 'Yes' %}bg-success{% else %}bg-danger{% endif %}" style="font-size: 0.85rem; padding: 5px 10px;">
                                                {{ entry.bin_contamination_check_4|default:"—" }}
                                            </span>
                                        </td>
                                        <td class="text-center" style="{% if entry.bin_contamination_check_5 == 'No' %}background-color: rgba(220, 53, 69, 0.3); border: 2px solid #dc3545;{% endif %} vertical-align: middle;">
                                            <span class="badge {% if entry.bin_contamination_check_5 == 'Yes' %}bg-success{% else %}bg-danger{% endif %}" style="font-size: 0.85rem; padding: 5px 10px;">
                                                {{ entry.bin_contamination_check_5|default:"—" }}
                                            </span>
                                        </td>
                                        {% endif %}
                                        
                                        <!-- Comments Column (Condensed) -->
                                        <td style="vertical-align: middle; padding: 8px; background: rgba(0,0,0,0.3); font-size: 0.8rem;">
                                            <div style="display: flex; flex-direction: column; gap: 5px;">
                                                {% if param_data.parameter_group == 'uv_vacuum' %}
                                                    {% if entry.uv_vacuum_test_1_comment %}<div style="background: rgba(255, 193, 7, 0.15); border-left: 2px solid #ffc107; padding: 4px 6px; border-radius: 3px;"><strong style="color: #ffc107;">R1:</strong> <span style="color: #fff; font-style: italic;">{{ entry.uv_vacuum_test_1_comment|truncatewords:5 }}</span></div>{% endif %}
                                                    {% if entry.uv_vacuum_test_2_comment %}<div style="background: rgba(255, 193, 7, 0.15); border-left: 2px solid #ffc107; padding: 4px 6px; border-radius: 3px;"><strong style="color: #ffc107;">R2:</strong> <span style="color: #fff; font-style: italic;">{{ entry.uv_vacuum_test_2_comment|truncatewords:5 }}</span></div>{% endif %}
                                                    {% if entry.uv_vacuum_test_3_comment %}<div style="background: rgba(255, 193, 7, 0.15); border-left: 2px solid #ffc107; padding: 4px 6px; border-radius: 3px;"><strong style="color: #ffc107;">R3:</strong> <span style="color: #fff; font-style: italic;">{{ entry.uv_vacuum_test_3_comment|truncatewords:5 }}</span></div>{% endif %}
                                                    {% if entry.uv_vacuum_test_4_comment %}<div style="background: rgba(255, 193, 7, 0.15); border-left: 2px solid #ffc107; padding: 4px 6px; border-radius: 3px;"><strong style="color: #ffc107;">R4:</strong> <span style="color: #fff; font-style: italic;">{{ entry.uv_vacuum_test_4_comment|truncatewords:5 }}</span></div>{% endif %}
                                                    {% if entry.uv_vacuum_test_5_comment %}<div style="background: rgba(255, 193, 7, 0.15); border-left: 2px solid #ffc107; padding: 4px 6px; border-radius: 3px;"><strong style="color: #ffc107;">R5:</strong> <span style="color: #fff; font-style: italic;">{{ entry.uv_vacuum_test_5_comment|truncatewords:5 }}</span></div>{% endif %}
                                                {% elif param_data.parameter_group == 'uv_flow' %}
                                                    {% if entry.uv_flow_value_1_comment %}<div style="background: rgba(255, 193, 7, 0.15); border-left: 2px solid #ffc107; padding: 4px 6px; border-radius: 3px;"><strong style="color: #ffc107;">R1:</strong> <span style="color: #fff; font-style: italic;">{{ entry.uv_flow_value_1_comment|truncatewords:5 }}</span></div>{% endif %}
                                                    {% if entry.uv_flow_value_2_comment %}<div style="background: rgba(255, 193, 7, 0.15); border-left: 2px solid #ffc107; padding: 4px 6px; border-radius: 3px;"><strong style="color: #ffc107;">R2:</strong> <span style="color: #fff; font-style: italic;">{{ entry.uv_flow_value_2_comment|truncatewords:5 }}</span></div>{% endif %}
                                                    {% if entry.uv_flow_value_3_comment %}<div style="background: rgba(255, 193, 7, 0.15); border-left: 2px solid #ffc107; padding: 4px 6px; border-radius: 3px;"><strong style="color: #ffc107;">R3:</strong> <span style="color: #fff; font-style: italic;">{{ entry.uv_flow_value_3_comment|truncatewords:5 }}</span></div>{% endif %}
                                                    {% if entry.uv_flow_value_4_comment %}<div style="background: rgba(255, 193, 7, 0.15); border-left: 2px solid #ffc107; padding: 4px 6px; border-radius: 3px;"><strong style="color: #ffc107;">R4:</strong> <span style="color: #fff; font-style: italic;">{{ entry.uv_flow_value_4_comment|truncatewords:5 }}</span></div>{% endif %}
                                                    {% if entry.uv_flow_value_5_comment %}<div style="background: rgba(255, 193, 7, 0.15); border-left: 2px solid #ffc107; padding: 4px 6px; border-radius: 3px;"><strong style="color: #ffc107;">R5:</strong> <span style="color: #fff; font-style: italic;">{{ entry.uv_flow_value_5_comment|truncatewords:5 }}</span></div>{% endif %}
                                                {% elif param_data.parameter_group == 'umbrella_valve' %}
                                                    {% if entry.umbrella_valve_assembly_1_comment %}<div style="background: rgba(255, 193, 7, 0.15); border-left: 2px solid #ffc107; padding: 4px 6px; border-radius: 3px;"><strong style="color: #ffc107;">C1:</strong> <span style="color: #fff; font-style: italic;">{{ entry.umbrella_valve_assembly_1_comment|truncatewords:5 }}</span></div>{% endif %}
                                                    {% if entry.umbrella_valve_assembly_2_comment %}<div style="background: rgba(255, 193, 7, 0.15); border-left: 2px solid #ffc107; padding: 4px 6px; border-radius: 3px;"><strong style="color: #ffc107;">C2:</strong> <span style="color: #fff; font-style: italic;">{{ entry.umbrella_valve_assembly_2_comment|truncatewords:5 }}</span></div>{% endif %}
                                                    {% if entry.umbrella_valve_assembly_3_comment %}<div style="background: rgba(255, 193, 7, 0.15); border-left: 2px solid #ffc107; padding: 4px 6px; border-radius: 3px;"><strong style="color: #ffc107;">C3:</strong> <span style="color: #fff; font-style: italic;">{{ entry.umbrella_valve_assembly_3_comment|truncatewords:5 }}</span></div>{% endif %}
                                                    {% if entry.umbrella_valve_assembly_4_comment %}<div style="background: rgba(255, 193, 7, 0.15); border-left: 2px solid #ffc107; padding: 4px 6px; border-radius: 3px;"><strong style="color: #ffc107;">C4:</strong> <span style="color: #fff; font-style: italic;">{{ entry.umbrella_valve_assembly_4_comment|truncatewords:5 }}</span></div>{% endif %}
                                                    {% if entry.umbrella_valve_assembly_5_comment %}<div style="background: rgba(255, 193, 7, 0.15); border-left: 2px solid #ffc107; padding: 4px 6px; border-radius: 3px;"><strong style="color: #ffc107;">C5:</strong> <span style="color: #fff; font-style: italic;">{{ entry.umbrella_valve_assembly_5_comment|truncatewords:5 }}</span></div>{% endif %}
                                                {% elif param_data.parameter_group == 'uv_clip' %}
                                                    {% if entry.uv_clip_pressing_1_comment %}<div style="background: rgba(255, 193, 7, 0.15); border-left: 2px solid #ffc107; padding: 4px 6px; border-radius: 3px;"><strong style="color: #ffc107;">C1:</strong> <span style="color: #fff; font-style: italic;">{{ entry.uv_clip_pressing_1_comment|truncatewords:5 }}</span></div>{% endif %}
                                                    {% if entry.uv_clip_pressing_2_comment %}<div style="background: rgba(255, 193, 7, 0.15); border-left: 2px solid #ffc107; padding: 4px 6px; border-radius: 3px;"><strong style="color: #ffc107;">C2:</strong> <span style="color: #fff; font-style: italic;">{{ entry.uv_clip_pressing_2_comment|truncatewords:5 }}</span></div>{% endif %}
                                                    {% if entry.uv_clip_pressing_3_comment %}<div style="background: rgba(255, 193, 7, 0.15); border-left: 2px solid #ffc107; padding: 4px 6px; border-radius: 3px;"><strong style="color: #ffc107;">C3:</strong> <span style="color: #fff; font-style: italic;">{{ entry.uv_clip_pressing_3_comment|truncatewords:5 }}</span></div>{% endif %}
                                                    {% if entry.uv_clip_pressing_4_comment %}<div style="background: rgba(255, 193, 7, 0.15); border-left: 2px solid #ffc107; padding: 4px 6px; border-radius: 3px;"><strong style="color: #ffc107;">C4:</strong> <span style="color: #fff; font-style: italic;">{{ entry.uv_clip_pressing_4_comment|truncatewords:5 }}</span></div>{% endif %}
                                                    {% if entry.uv_clip_pressing_5_comment %}<div style="background: rgba(255, 193, 7, 0.15); border-left: 2px solid #ffc107; padding: 4px 6px; border-radius: 3px;"><strong style="color: #ffc107;">C5:</strong> <span style="color: #fff; font-style: italic;">{{ entry.uv_clip_pressing_5_comment|truncatewords:5 }}</span></div>{% endif %}
                                                {% elif param_data.parameter_group == 'workstation' %}
                                                    {% if entry.workstation_clean_comment %}<div style="background: rgba(255, 193, 7, 0.15); border-left: 2px solid #ffc107; padding: 4px 6px; border-radius: 3px;"><strong style="color: #ffc107;">Note:</strong> <span style="color: #fff; font-style: italic;">{{ entry.workstation_clean_comment|truncatewords:5 }}</span></div>{% endif %}
                                                {% elif param_data.parameter_group == 'bin_contamination' %}
                                                    {% if entry.bin_contamination_check_1_comment %}<div style="background: rgba(255, 193, 7, 0.15); border-left: 2px solid #ffc107; padding: 4px 6px; border-radius: 3px;"><strong style="color: #ffc107;">B1:</strong> <span style="color: #fff; font-style: italic;">{{ entry.bin_contamination_check_1_comment|truncatewords:5 }}</span></div>{% endif %}
                                                    {% if entry.bin_contamination_check_2_comment %}<div style="background: rgba(255, 193, 7, 0.15); border-left: 2px solid #ffc107; padding: 4px 6px; border-radius: 3px;"><strong style="color: #ffc107;">B2:</strong> <span style="color: #fff; font-style: italic;">{{ entry.bin_contamination_check_2_comment|truncatewords:5 }}</span></div>{% endif %}
                                                    {% if entry.bin_contamination_check_3_comment %}<div style="background: rgba(255, 193, 7, 0.15); border-left: 2px solid #ffc107; padding: 4px 6px; border-radius: 3px;"><strong style="color: #ffc107;">B3:</strong> <span style="color: #fff; font-style: italic;">{{ entry.bin_contamination_check_3_comment|truncatewords:5 }}</span></div>{% endif %}
                                                    {% if entry.bin_contamination_check_4_comment %}<div style="background: rgba(255, 193, 7, 0.15); border-left: 2px solid #ffc107; padding: 4px 6px; border-radius: 3px;"><strong style="color: #ffc107;">B4:</strong> <span style="color: #fff; font-style: italic;">{{ entry.bin_contamination_check_4_comment|truncatewords:5 }}</span></div>{% endif %}
                                                    {% if entry.bin_contamination_check_5_comment %}<div style="background: rgba(255, 193, 7, 0.15); border-left: 2px solid #ffc107; padding: 4px 6px; border-radius: 3px;"><strong style="color: #ffc107;">B5:</strong> <span style="color: #fff; font-style: italic;">{{ entry.bin_contamination_check_5_comment|truncatewords:5 }}</span></div>{% endif %}
                                                {% endif %}
                                                
                                                {% if entry.is_after_maintenance and entry.maintenance_comment %}
                                                <div style="background: rgba(255, 193, 7, 0.25); border-left: 2px solid #ff9800; padding: 4px 6px; border-radius: 3px; margin-top: 3px;">
                                                    <strong style="color: #ff9800;"><i class="fas fa-tools"></i></strong> 
                                                    <span style="color: #fff; font-style: italic;">{{ entry.maintenance_comment|truncatewords:5 }}</span>
                                                </div>
                                                {% endif %}
                                                
                                                {% if not entry.uv_vacuum_test_1_comment and not entry.uv_vacuum_test_2_comment and not entry.uv_vacuum_test_3_comment and not entry.uv_vacuum_test_4_comment and not entry.uv_vacuum_test_5_comment and not entry.uv_flow_value_1_comment and not entry.uv_flow_value_2_comment and not entry.uv_flow_value_3_comment and not entry.uv_flow_value_4_comment and not entry.uv_flow_value_5_comment and not entry.umbrella_valve_assembly_1_comment and not entry.umbrella_valve_assembly_2_comment and not entry.umbrella_valve_assembly_3_comment and not entry.umbrella_valve_assembly_4_comment and not entry.umbrella_valve_assembly_5_comment and not entry.uv_clip_pressing_1_comment and not entry.uv_clip_pressing_2_comment and not entry.uv_clip_pressing_3_comment and not entry.uv_clip_pressing_4_comment and not entry.uv_clip_pressing_5_comment and not entry.workstation_clean_comment and not entry.bin_contamination_check_1_comment and not entry.bin_contamination_check_2_comment and not entry.bin_contamination_check_3_comment and not entry.bin_contamination_check_4_comment and not entry.bin_contamination_check_5_comment and not entry.maintenance_comment %}
                                                <div style="color: #666; font-style: italic; text-align: center; padding: 8px;">
                                                    <i class="fas fa-check-circle"></i> No issues
                                                </div>
                                                {% endif %}
                                            </div>
                                        </td>
                                        
                                        <!-- VERIFICATION COLUMN - FIXED VERSION -->
                                        <td style="vertical-align: middle; padding: 6px; background: rgba(0,0,0,0.5);">
                                            {% if entry.is_fully_verified %}
                                                <!-- Fully Verified -->
                                                <div class="text-center">
                                                    {% if entry.supervisor_verification.status == 'approved' and entry.quality_verification.status == 'approved' %}
                                                        <span class="badge bg-success" style="font-size: 0.75rem; padding: 5px 8px; display: block; margin-bottom: 5px;">
                                                            <i class="fas fa-check-double"></i> Approved
                                                        </span>
                                                    {% else %}
                                                        <span class="badge bg-danger" style="font-size: 0.75rem; padding: 5px 8px; display: block; margin-bottom: 5px;">
                                                            <i class="fas fa-times-circle"></i> Rejected
                                                        </span>
                                                    {% endif %}
                                                    
                                                    <button class="btn btn-sm btn-outline-light" type="button" data-bs-toggle="collapse" data-bs-target="#verify-{{ entry.id }}" style="font-size: 0.7rem; padding: 3px 8px;">
                                                        <i class="fas fa-eye"></i> Details
                                                    </button>
                                                    
                                                    <div class="collapse mt-2" id="verify-{{ entry.id }}">
                                                        <div style="background: rgba(0,0,0,0.5); padding: 6px; border-radius: 4px; text-align: left; font-size: 0.7rem;">
                                                            <!-- Supervisor Verification Details -->
                                                            <div class="mb-2" style="border-bottom: 1px solid #444; padding-bottom: 5px;">
                                                                <strong style="color: #ffc107;">
                                                                    <i class="fas fa-user-tie"></i> Supervisor:
                                                                </strong>
                                                                <div style="margin-left: 0.5rem; margin-top: 3px;">
                                                                    {% if entry.supervisor_verification.status == 'approved' %}
                                                                        <span class="badge bg-success" style="font-size: 0.65rem;">
                                                                            <i class="fas fa-check"></i> Approved
                                                                        </span>
                                                                    {% else %}
                                                                        <span class="badge bg-danger" style="font-size: 0.65rem;">
                                                                            <i class="fas fa-times"></i> Rejected
                                                                        </span>
                                                                    {% endif %}
                                                                </div>
                                                                <div style="color: #999; font-size: 0.65rem; margin-left: 0.5rem; margin-top: 2px;">
                                                                    {{ entry.supervisor_verification.verified_by.get_full_name|default:entry.supervisor_verification.verified_by.username }}
                                                                </div>
                                                                <div style="color: #999; font-size: 0.65rem; margin-left: 0.5rem;">
                                                                    {{ entry.supervisor_verification.verified_at|date:"d M, H:i" }}
                                                                </div>
                                                                {% if entry.supervisor_verification.comment %}
                                                                <div style="color: #aaa; font-style: italic; margin-left: 0.5rem; margin-top: 3px; background: rgba(255,255,255,0.05); padding: 3px 5px; border-radius: 3px;">
                                                                    "{{ entry.supervisor_verification.comment|truncatewords:10 }}"
                                                                </div>
                                                                {% endif %}
                                                            </div>
                                                            
                                                            <!-- Quality Verification Details -->
                                                            <div>
                                                                <strong style="color: #17a2b8;">
                                                                    <i class="fas fa-award"></i> Quality:
                                                                </strong>
                                                                <div style="margin-left: 0.5rem; margin-top: 3px;">
                                                                    {% if entry.quality_verification.status == 'approved' %}
                                                                        <span class="badge bg-success" style="font-size: 0.65rem;">
                                                                            <i class="fas fa-check"></i> Approved
                                                                        </span>
                                                                    {% else %}
                                                                        <span class="badge bg-danger" style="font-size: 0.65rem;">
                                                                            <i class="fas fa-times"></i> Rejected
                                                                        </span>
                                                                    {% endif %}
                                                                </div>
                                                                <div style="color: #999; font-size: 0.65rem; margin-left: 0.5rem; margin-top: 2px;">
                                                                    {{ entry.quality_verification.verified_by.get_full_name|default:entry.quality_verification.verified_by.username }}
                                                                </div>
                                                                <div style="color: #999; font-size: 0.65rem; margin-left: 0.5rem;">
                                                                    {{ entry.quality_verification.verified_at|date:"d M, H:i" }}
                                                                </div>
                                                                {% if entry.quality_verification.comment %}
                                                                <div style="color: #aaa; font-style: italic; margin-left: 0.5rem; margin-top: 3px; background: rgba(255,255,255,0.05); padding: 3px 5px; border-radius: 3px;">
                                                                    "{{ entry.quality_verification.comment|truncatewords:10 }}"
                                                                </div>
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                            {% elif entry.is_supervisor_verified %}
                                                <!-- Supervisor Verified, Quality Pending -->
                                                <div class="text-center">
                                                    <!-- Show supervisor status with color -->
                                                    {% if entry.supervisor_verification.status == 'approved' %}
                                                        <span class="badge bg-success" style="font-size: 0.7rem; padding: 4px 6px; display: block; margin-bottom: 5px;">
                                                            <i class="fas fa-check"></i> Sup: Approved
                                                        </span>
                                                    {% else %}
                                                        <span class="badge bg-danger" style="font-size: 0.7rem; padding: 4px 6px; display: block; margin-bottom: 5px;">
                                                            <i class="fas fa-times"></i> Sup: Rejected
                                                        </span>
                                                    {% endif %}
                                                    
                                                    {% if can_verify_quality %}
                                                    <button class="btn btn-sm btn-info" type="button" data-bs-toggle="collapse" data-bs-target="#quality-form-{{ entry.id }}" style="font-size: 0.7rem; padding: 3px 8px;">
                                                        <i class="fas fa-clipboard-check"></i> Verify
                                                    </button>
                                                    
                                                    <div class="collapse mt-2" id="quality-form-{{ entry.id }}">
                                                        <form method="post" action="{% url 'verify_parameter_entry' entry.id %}" style="background: rgba(0,0,0,0.5); padding: 6px; border-radius: 4px;">
                                                            {% csrf_token %}
                                                            
                                                            <div class="btn-group btn-group-sm w-100 mb-2" role="group">
                                                                <input type="radio" class="btn-check" name="status" id="q-approve-{{ entry.id }}" value="approved" required>
                                                                <label class="btn btn-outline-success" for="q-approve-{{ entry.id }}" style="font-size: 0.7rem; padding: 3px;">
                                                                    <i class="fas fa-check"></i>
                                                                </label>
                                                                
                                                                <input type="radio" class="btn-check" name="status" id="q-reject-{{ entry.id }}" value="rejected" required>
                                                                <label class="btn btn-outline-danger" for="q-reject-{{ entry.id }}" style="font-size: 0.7rem; padding: 3px;">
                                                                    <i class="fas fa-times"></i>
                                                                </label>
                                                            </div>
                                                            
                                                            <textarea 
                                                                class="form-control form-control-sm mb-2" 
                                                                name="comment" 
                                                                rows="2" 
                                                                placeholder="Comment (optional)"
                                                                style="font-size: 0.7rem; background: rgba(0,0,0,0.7); color: white; border-color: #444;"
                                                            ></textarea>
                                                            
                                                            <button type="submit" class="btn btn-sm btn-info w-100" style="font-size: 0.7rem; padding: 3px;">
                                                                <i class="fas fa-check-circle"></i> Submit
                                                            </button>
                                                        </form>
                                                    </div>
                                                    {% else %}
                                                    <div style="font-size: 0.65rem; color: #aaa; margin-top: 5px;">
                                                        <i class="fas fa-hourglass-half"></i> Quality Pending
                                                    </div>
                                                    {% endif %}
                                                </div>
                                                
                                            {% else %}
                                                <!-- Supervisor Verification Pending -->
                                                {% if can_verify_supervisor %}
                                                <div class="text-center">
                                                    <button class="btn btn-sm btn-warning" type="button" data-bs-toggle="collapse" data-bs-target="#supervisor-form-{{ entry.id }}" style="font-size: 0.7rem; padding: 3px 8px;">
                                                        <i class="fas fa-clipboard-check"></i> Verify
                                                    </button>
                                                    
                                                    <div class="collapse mt-2" id="supervisor-form-{{ entry.id }}">
                                                        <form method="post" action="{% url 'verify_parameter_entry' entry.id %}" style="background: rgba(0,0,0,0.5); padding: 6px; border-radius: 4px;">
                                                            {% csrf_token %}
                                                            
                                                            <div class="btn-group btn-group-sm w-100 mb-2" role="group">
                                                                <input type="radio" class="btn-check" name="status" id="s-approve-{{ entry.id }}" value="approved" required>
                                                                <label class="btn btn-outline-success" for="s-approve-{{ entry.id }}" style="font-size: 0.7rem; padding: 3px;">
                                                                    <i class="fas fa-check"></i>
                                                                </label>
                                                                
                                                                <input type="radio" class="btn-check" name="status" id="s-reject-{{ entry.id }}" value="rejected" required>
                                                                <label class="btn btn-outline-danger" for="s-reject-{{ entry.id }}" style="font-size: 0.7rem; padding: 3px;">
                                                                    <i class="fas fa-times"></i>
                                                                </label>
                                                            </div>
                                                            
                                                            <textarea 
                                                                class="form-control form-control-sm mb-2" 
                                                                name="comment" 
                                                                rows="2" 
                                                                placeholder="Comment (optional)"
                                                                style="font-size: 0.7rem; background: rgba(0,0,0,0.7); color: white; border-color: #444;"
                                                            ></textarea>
                                                            
                                                            <button type="submit" class="btn btn-sm btn-warning w-100" style="font-size: 0.7rem; padding: 3px;">
                                                                <i class="fas fa-check-circle"></i> Submit
                                                            </button>
                                                        </form>
                                                    </div>
                                                </div>
                                                {% else %}
                                                <div class="text-center">
                                                    <span class="badge bg-secondary" style="font-size: 0.7rem; padding: 4px 6px;">
                                                        <i class="fas fa-hourglass-half"></i> Pending
                                                    </span>
                                                </div>
                                                {% endif %}
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    {% endfor %}
                    
                {% else %}
                    <!-- Empty State -->
                    <div class="text-center py-5">
                        <i class="fas fa-inbox" style="font-size: 4rem; color: #444;"></i>
                        <h5 class="mt-3" style="color: #aaa;">
                            No Parameter Entries Yet
                            <span class="hindi-text">कोई पैरामीटर प्रविष्टि नहीं</span>
                        </h5>
                        {% if can_add_parameters %}
                        <a href="{% url 'fill_parameter_group' checklist.id %}" class="btn btn-success mt-3">
                            <i class="fas fa-plus-circle"></i> Start Filling Parameters
                            <span class="hindi-text">पैरामीटर भरना शुरू करें</span>
                        </a>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endif %}
<!-- END: Enhanced Parameter Entries Section with Verification -->


          
                </div>
            </div>
        </div>
    </div>

    <!-- Concerns Section -->
    <div class="mb-1 mt-2">
        <div class="card shadow-lg">
            <div class="card-header d-flex justify-content-between align-items-center bg-primary text-white">
                <h5 class="mb-0 section-title">
                    Quality Concerns and Actions
                    <span class="section-title-hindi">गुणवत्ता चिंताएं और कार्यवाही</span>
                </h5>
                {% if checklist.status != 'quality_approved' %}
                <a href="{% url 'add_concern' checklist.id %}" class="btn btn-light btn-sm">
                    <i class="fas fa-exclamation-triangle me-1"></i>Report Concern
                    <span class="hindi-text">समस्या रिपोर्ट करें</span>
                </a>
                {% endif %}
            </div>
            <div class="card-body">
                {% if concerns %}
                <div class="table-responsive">
                    <table class="table table-bordered table-hover align-middle table-header-with-hindi">
                        <thead class="table-light">
                            <tr>
                                <th style="width: 5%">#</th>
                                <th style="width: 30%">
                                    Concern
                                    <span class="hindi-text">समस्या</span>
                                </th>
                                <th style="width: 30%">
                                    Cause
                                    <span class="hindi-text">कारण</span>
                                </th>
                                <th style="width: 25%">
                                    Action Taken
                                    <span class="hindi-text">की गई कार्यवाही</span>
                                </th>
                                <th style="width: 10%">
                                    Date
                                    <span class="hindi-text">दिनांक</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for concern in concerns %}
                            <tr>
                                <td class="text-center align-middle text-light fw-bold">{{ forloop.counter }}</td>
                                <td class="text-light">{{ concern.concern_identified }}</td>
                                <td class="text-light">{{ concern.cause_if_known|default:"—" }}</td>
                                <td class="text-light">{{ concern.action_taken|default:"Pending" }}</td>
                                <td class="text-center align-middle">
                                    <div class="small text-white-50">
                                        {{ concern.created_at|date:"Y-m-d H:i" }}
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-3">
                    <p class="text-muted mb-2">
                        No quality concerns reported
                        <span class="hindi-text">कोई गुणवत्ता चिंता रिपोर्ट नहीं की गई</span>
                    </p>
                    {% if checklist.status != 'quality_approved' %}
                    <a href="{% url 'add_concern' checklist.id %}" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-plus-circle me-1"></i>Report New Concern
                        <span class="hindi-text">नई समस्या रिपोर्ट करें</span>
                    </a>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
    });
    
    // Helper function to get CSRF token
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    
    // Toggle Verification Form
    const toggleButtons = document.querySelectorAll('.toggle-verification-form');
    const cancelButtons = document.querySelectorAll('.cancel-verification');
    
    toggleButtons.forEach(button => {
        button.addEventListener('click', function() {
            const subgroupId = this.getAttribute('data-subgroup-id');
            const verifierType = this.getAttribute('data-verifier-type');
            const formContainer = document.getElementById('verification-form-' + subgroupId);
            
            // Set the verifier type in the hidden field
            document.getElementById('verifier-type-' + subgroupId).value = verifierType;
            
            // Show the form
            formContainer.style.display = 'block';
            
            // Hide the button
            this.style.display = 'none';
        });
    });
    
    cancelButtons.forEach(button => {
        button.addEventListener('click', function() {
            const formContainer = this.closest('.verification-form');
            const subgroupId = formContainer.id.split('-').pop();
            
            // Hide the form
            formContainer.style.display = 'none';
            
            // Show the appropriate toggle button again
            const verifierTypeInput = document.getElementById('verifier-type-' + subgroupId);
            const verifierType = verifierTypeInput ? verifierTypeInput.value : '';
            const toggleButtons = document.querySelectorAll('.toggle-verification-form[data-subgroup-id="' + subgroupId + '"][data-verifier-type="' + verifierType + '"]');
            toggleButtons.forEach(btn => {
                btn.style.display = '';
            });
        });
    });
    
    // Handle inline verification form submission
    const verificationForms = document.querySelectorAll('.inline-verification-form');
    
    verificationForms.forEach(form => {
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const formAction = this.getAttribute('action');
            const csrftoken = getCookie('csrftoken');
            
            // Get the submit button
            const submitBtn = this.querySelector('button[type="submit"]');
            let originalBtnText = submitBtn.innerHTML;
            
            // Show loading indicator
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            submitBtn.disabled = true;
            
            fetch(formAction, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': csrftoken
                },
                credentials: 'same-origin'
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(data => {
                        throw new Error(data.message || 'Server error');
                    }).catch(err => {
                        throw new Error(`Server error: ${response.status}`);
                    });
                }
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    // Show success message
                    alert(data.message || 'Verification successful');
                    // Reload the page to show updated verification status
                    window.location.reload();
                } else {
                    alert(data.message || 'Verification failed');
                    // Reset button
                    submitBtn.innerHTML = originalBtnText;
                    submitBtn.disabled = false;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error: ' + error.message);
                
                // Reset button
                submitBtn.innerHTML = originalBtnText;
                submitBtn.disabled = false;
            });
        });
    });
});

 // Initialize tooltips for comments
document.addEventListener('DOMContentLoaded', function() {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
    });
});

</script>
{% endblock %}